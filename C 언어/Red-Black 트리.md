## Red-Black 트리

### Red-Black 트리

- 이진 탐색 트리(BST)의 한 종류
- 스스로 균형(balancing) 잡는 트리
- BST의 worst case의 단점을 개선
  - 모든 노드는 red 혹은 black



### Red-Black 트리 속성

- #1 모든 노드는 red 혹은 black

- #2 루트 노드는 black

##### nil 노드란?

1. 존재하지 않음을 의미하는 노드
2. 자녀가 없을 때 자녀를 nil 노드로 표기
3. 값이 있는 노드와 동등하게 취급

4. RB 트리에서 leaf 노드는 nil 노드

- #3 모든 nil(leaf)노드는 black

-  #4 (red의 자녀들은 black) or (red가 연속적으로 존재 할 수 없다.)

- #5  black height : 임의의 노드에서 자손 nil 노드들 까지 가는 경로들의 black 수는 같다(자기 자신은 카운트 제외)



##### 색을 바꾸면서도 속성 유지

- RB 트리가 #5 속성을 만족하고 있고 두자녀가 같은 색을 가질 때 부모와 두 자녀의 색을 바꿔줘도 속성은 그대로 유지 된다.
  - #5 속성: 임의의 노드에서 자손 nil 노드들 까지 가는 경로들의 black 수는 같다

##### RB 트리는 어떻게 균형을 잡는가?

- 삽입 /삭제 시 주로 #4, # 5를 위반하며 이들을 해결하려고 주고를 바꾸다 보면 자연스럽게 트리의 균형이 잡히게 된다.
  - #4 노드가 red라면 자녀들은 black
  - #5 임의의 노드에서 자손 nil 노드들 까지 가는 경로들의 black 수는 같다.



### Red - Black 트리 삽입 방식

0.  삽입 전 RB 트리 속성 만족한 상태
1.  삽입 방식은 일반적인 BST와 동일
2.  삽입 후 RB 트리 위반 여부 확인
3.  RB 트리 속성을 위반했다면 재조정
4.  RB 트리 속성을 다시 만족



- insert(50)
  - 노드를 삽입할 때 두 nil 노드의 색은 black으로 고정한다 그러면 자연스럽게 #3 속성을 만족
    - #3 모든 nil 노드는 black
  - Red-Black 트리 #2 속성 위반 루트 노드를 balck으로 바꾸면 해결
    - #2 루트 노드는 black



- insert(20)
  - Red-Black 트리의 모든 속성을 만족
    - 왜 새로 삽입하는 노드는 red 인가?
    - 삽입후에도 #5 속성을 만족하기 위해
      - #5 : 임의의 노드에서 자손 nil 노드들가지 가는 경로들의 black 수는 같다.
  - 이제부터 nil 노드를 표기하지 않아도 삽입되는 노드는 nil 노드가 두 개 있고 nil 노드는 black임을 기억해 주세요



##### case.3 해결하기

- 할아버지한테 가는 경로가 일직선

- 삽입된 red 노드가 부모의 왼쪽 자녀 & 부모도 red고 할아버지의 왼쪽자녀 & 삼촌(=부모의 형제)은 black이라면

  부모와 할아버지의 색을 바꾼 후 할아버지 기준으로 오른쪽(왼쪽)으로 회전

- insert(10)
  - red가 한쪽으로 몰려 있으니 red 하나를 반대편으로 옮겨준다
  - 구조를 바꾸면서도 BST의 특징을 유지시키는 방법은 회전이다.
  - #4 속성 위반을 해결하기 위해 red 하나를 넘겨야 하는데 BST 특징 또한 유지하면서 넘기려면 회전을 사용해야 한다
    - #4 노드가 red라면 자녀들은 black
  - 20과 50의 색을 바꿔 준다
  - 50을 기준으로 오른쪽으로 회전한다



##### case.2 해결하기

- 할아버지 한테 가는 경로가 꺾여 있음

- 삽입된 red 노드가 부모의 오른쪽 자녀 & 부모도 red고 할아버지의 왼쪽 자녀 & 삼촌(=부모의 형제)은 black이라면 부모를 기준으로 왼쪽으로 회전한 뒤 case.3의 방식으로 해결 (오른쪽 왼쪽을 바꿔도 성립)

- insert(40)

  - #4 속성 위반을 해결하기 위해 red 하나를 넘겨야 하는데 BST 특징 또한 유지하면서 넘기려면 회전을 사용해야 한다

    회전을 어떻게 사용할지가 관건이다.

  - case.3 과 살짝 다른점은 삽입된 노드를 기준으로 할아버지 까지의 경로가 꺾였다는 점
  - 꺾인 부분을 펴줘서 case.3과 같은 형태로 만들면 case.3과 같은 방식으로 해결 가능
  - 20 기준으로 왼쪽으로 회전한다
  - 40과 50의 색을 바꾼다
  - 50 기준으로 오른쪽으로 회전한다

##### case.1 해결하기

- 삽입된 red 노드의 부모도 red & 삼촌(=부모의 형제)도 red라면 부모와 삼촌을 black으로 바꾸고 할아버지를 red로 바꾼 뒤 할아버지에서 다시 확인을 시작한다.

- insert(30)
  - red가 한 쪽으로 몰려 있지 않아서 옮길 수 가 없다.
  - 10과 50을 black으로 바꾸고 20을 red로 바꾸면 된다.



##### Red-Black 트리 예제

![레드 블랙 트리 예제](C:\Users\holho\OneDrive\DeskTop\레드 블랙 트리 예제.png)



